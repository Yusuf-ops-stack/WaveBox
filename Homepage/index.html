<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WaveBox Music Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">


<style>
:root{
  --bg:#0f172a; --panel:#020617; --card:#1e293b;
  --text:#ffffff; --accent:#38bdf8;
}
.light{--bg:#f1f5f9;--panel:#ffffff;--card:#e5e7eb;--text:#020617;--accent:#0284c7;}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{background:var(--bg);color:var(--text);height:100vh}

.app{display:flex;height:calc(100vh - 120px)}
.sidebar{width:220px;background:var(--panel);padding:20px;}
.sidebar h1{color:var(--accent);}
.sidebar label, .sidebar button{margin-top:10px;padding:8px;width:100%;border:none;border-radius:8px;background:var(--accent);color:white;cursor:pointer;display:block;text-align:center;}
.player{flex:1;display:flex;flex-direction:column;align-items:center;padding:30px;}
.cover{width:220px;height:220px;border-radius:16px;object-fit:cover;box-shadow:0 10px 30px rgba(0,0,0,.5);}
.controls button{background:none;border:none;font-size:26px;margin:0 12px;color:var(--text);cursor:pointer;}
input[type=range]{width:320px;margin:8px 0;}
#playlist{list-style:none;width:320px;margin-top:15px;}
#playlist li{padding:10px;border-radius:8px;cursor:pointer;}
#playlist li.active,#playlist li:hover{background:var(--card);}
.mini{height:90px;background:var(--panel);display:flex;align-items:center;padding:10px 20px;}
.mini img{width:55px;height:55px;border-radius:8px;}
.mini .info{flex:1;margin-left:15px;}
.visualizer{display:flex;align-items:flex-end;height:100px;margin-top:15px;}
.bar{width:5px;background:var(--accent);margin:0 1px;animation:bounce 0.5s linear infinite;}
@keyframes bounce{0%,100%{height:10px;}50%{height:80px;}}
@media(max-width:700px){.sidebar{display:none}input[type=range],#playlist{width:90%}}
</style>
</head>

<body>
<div class="app">
  <div class="sidebar">
    <h1>ðŸŽ§ WaveBox</h1>
    <p>Feel Every Wave</p>
    <label>âž• Add Songs
      <input type="file" id="fileInput" multiple accept="audio/*" hidden>
    </label>
    <button onclick="toggleTheme()">ðŸŒ— Toggle Theme</button>
  </div>

  <div class="player">
    <img id="cover" class="cover" src="cover.jpg">
    <h2 id="title">No song selected</h2>
    <input type="range" id="progress" value="0">
    <div class="controls">
      <button onclick="toggleShuffle()"><i class="fa-solid fa-shuffle"></i></button>
      <button onclick="prevSong()"><i class="fa-solid fa-backward"></i></button>
      <button onclick="playPause()"><i class="fa-solid fa-play"></i></button>
      <button onclick="nextSong()"><i class="fa-solid fa-forward"></i></button>
      <button onclick="toggleRepeat()"><i class="fa-solid fa-repeat"></i></button>
    </div>
    <input type="range" id="volume" min="0" max="1" step="0.01">
    <ul id="playlist"></ul>
    <div class="visualizer" id="visualizer"></div>
    <audio id="audio"></audio>
  </div>
</div>

<!-- Mini Player -->
<div class="mini">
  <img id="miniCover" src="cover.jpg">
  <div class="info">
    <div id="miniTitle">No song</div>
    <input type="range" id="miniProgress" value="0">
  </div>
  <button onclick="playPause()"><i class="fa-solid fa-play"></i></button>
  <button onclick="nextSong()"><i class="fa-solid fa-forward"></i></button>
</div>

<script>
let songs=JSON.parse(localStorage.getItem('WaveBoxSongs')||'[]');
let index=0,shuffle=false,repeat=false;

const audio=document.getElementById("audio");
const title=document.getElementById("title");
const cover=document.getElementById("cover");
const miniCover=document.getElementById("miniCover");
const miniTitle=document.getElementById("miniTitle");
const progress=document.getElementById("progress");
const miniProgress=document.getElementById("miniProgress");
const volume=document.getElementById("volume");
const playlist=document.getElementById("playlist");
const fileInput=document.getElementById("fileInput");
const visualizer=document.getElementById("visualizer");

/* Audio Context for visualizer */
let audioCtx,analyser,source,dataArray;
function setupVisualizer(){
  if(!audioCtx){
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    source=audioCtx.createMediaElementSource(audio);
    analyser=audioCtx.createAnalyser();
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
    analyser.fftSize=64;
    dataArray=new Uint8Array(analyser.frequencyBinCount);
  }
}
function drawVisualizer(){
  if(!analyser) return;
  analyser.getByteFrequencyData(dataArray);
  visualizer.innerHTML='';
  for(let i=0;i<dataArray.length;i++){
    const bar=document.createElement('div');
    bar.classList.add('bar');
    bar.style.height=(dataArray[i]/2)+'px';
    visualizer.appendChild(bar);
  }
  requestAnimationFrame(drawVisualizer);
}

/* === ADD SONGS === */
fileInput.addEventListener("change",()=>{
  [...fileInput.files].forEach(file=>{
    songs.push({title:file.name.replace(/\.[^/.]+$/,""),src:URL.createObjectURL(file),cover:"cover.jpg"});
  });
  localStorage.setItem('WaveBoxSongs',JSON.stringify(songs));
  if(songs.length===fileInput.files.length) loadSong(0);
  updatePlaylist();
});

/* === PLAYER CONTROLS === */
function loadSong(i){
  if(!songs.length) return;
  index=i;
  audio.src=songs[i].src;
  title.textContent=songs[i].title;
  miniTitle.textContent=songs[i].title;
  cover.src=miniCover.src=songs[i].cover;
  updatePlaylist();
  setupVisualizer();
  drawVisualizer();
}

async function playPause(){
  try{
    setupVisualizer();
    drawVisualizer();
    if(audio.paused){
      await audio.play();
    }else{audio.pause();}
  }catch(e){console.log("Play interrupted");}
}

function nextSong(){
  if(!songs.length) return;
  index = shuffle?Math.floor(Math.random()*songs.length):(index+1)%songs.length;
  loadSong(index);audio.play();
}
function prevSong(){
  if(!songs.length) return;
  index=(index-1+songs.length)%songs.length;
  loadSong(index);audio.play();
}
function toggleShuffle(){shuffle=!shuffle;}
function toggleRepeat(){repeat=!repeat;audio.loop=repeat;}
function toggleTheme(){document.body.classList.toggle("light");}

/* === SLIDERS === */
audio.addEventListener("timeupdate",()=>{
  const p=(audio.currentTime/audio.duration)*100||0;
  progress.value=miniProgress.value=p;
});
progress.oninput=()=>audio.currentTime=(progress.value/100)*audio.duration;
miniProgress.oninput=progress.oninput;
volume.oninput=()=>audio.volume=volume.value;

/* === PLAYLIST === */
function updatePlaylist(){
  playlist.innerHTML="";
  songs.forEach((s,i)=>{
    const li=document.createElement("li");
    li.textContent=s.title;
    if(i===index) li.classList.add("active");
    li.onclick=()=>{loadSong(i);audio.play();}
    playlist.appendChild(li);
  });
}

/* === INIT === */
if(songs.length) loadSong(0);
</script>

</body>
</html>
