<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WaveBox Music Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">
<style>
:root{
  --bg:#0f172a; --panel:#020617; --card:#1e293b; --text:#fff; --accent:#38bdf8;
}
.light{
  --bg:#f1f5f9; --panel:#fff; --card:#e5e7eb; --text:#020617; --accent:#0284c7;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{background:var(--bg);color:var(--text);height:100vh;overflow-x:hidden;}

/* Layout */
.app{display:flex;height:100vh;flex-direction:row;}
.sidebar{width:220px;background:var(--panel);padding:20px;flex-shrink:0;transition: transform 0.3s ease;}
.sidebar h1{color:var(--accent)}
.sidebar label, .sidebar button{
  margin-top:10px;padding:8px;width:100%;border:none;border-radius:8px;
  background:var(--accent);color:white;cursor:pointer;display:block;text-align:center;
}
.player{flex:1;display:flex;flex-direction:column;align-items:center;padding:20px;position:relative;overflow-y:auto;}
.cover{width:220px;height:220px;border-radius:16px;object-fit:cover;box-shadow:0 10px 30px rgba(0,0,0,.5);transition: width 0.3s, height 0.3s;}
.controls button{background:none;border:none;font-size:26px;margin:0 10px;color:var(--text);cursor:pointer;}
input[type=range]{width:320px;margin:8px 0;}

/* Playlist */
#playlist{list-style:none;width:100%;margin-top:15px;}
#playlist li{padding:10px;border-radius:8px;cursor:pointer;}
#playlist li.active,#playlist li:hover{background:var(--card);}

/* Lyrics */
.lyrics{
  margin-top:20px; width:100%; max-width:400px; height:120px;
  background:var(--card); border-radius:12px; padding:10px; overflow-y:auto;
  font-size:14px; line-height:1.5; text-align:center;
}

/* Equalizer */
.equalizer{display:flex;justify-content:center;gap:10px;margin-top:20px;}
.equalizer input[type=range]{transform:rotate(-90deg);width:60px;}

/* Mini Player */
.mini{
  height:90px;background:var(--panel);display:flex;align-items:center;padding:10px 20px;
  position:fixed;bottom:10px;right:10px;border-radius:16px;box-shadow:0 5px 15px rgba(0,0,0,.5);
  z-index:1000;
  transition: all 0.3s;
}
.mini img{width:55px;height:55px;border-radius:8px;}
.mini .info{flex:1;margin-left:15px;}
.mini .controls button{font-size:20px;margin-left:10px;}

/* Install Toast */
#installToast{
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  background: #38bdf8; color: white; padding: 12px 20px; border-radius: 8px;
  display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 2000;
  transition: opacity 0.3s ease, bottom 0.3s ease;
}
#installToast.show{display: block; opacity: 1; bottom: 20px;}
#installToast.hide{opacity: 0; bottom: 0;}

/* Responsive - mobile */
@media(max-width:700px){
  .app{flex-direction:column;}
  .sidebar{width:100%; transform: translateY(-100%);}
  .sidebar.active{transform: translateY(0);}
  .player{padding:10px;}
  .cover{width:150px;height:150px;}
  input[type=range]{width:90%;}
  #playlist li{padding:8px;}
  .equalizer input[type=range]{width:40px;}
  .mini{bottom:70px; right:10px; height:70px; padding:5px;}
  .mini img{width:45px;height:45px;}
  .mini .controls button{font-size:18px; margin-left:5px;}
}

/* Hamburger for mobile */
#menuToggle{
  display:none; position:fixed; top:10px; left:10px; z-index:2000;
  background:var(--accent); border:none; color:#fff; padding:10px; border-radius:8px; font-size:20px; cursor:pointer;
}
@media(max-width:700px){#menuToggle{display:block;}}
</style>
</head>
<body>

<!-- Hamburger -->
<button id="menuToggle">â˜°</button>

<div class="app">
  <div class="sidebar" id="sidebar">
    <h1>ðŸŽ§ WaveBox</h1>
    <p>Feel Every Wave</p>
    <label>âž• Add Songs<input type="file" id="fileInput" multiple accept="audio/*" hidden></label>
    <button onclick="toggleTheme()">ðŸŒ— Toggle Theme</button>
    <button id="installBtn">ðŸ“¥ Install App</button>
  </div>

  <div class="player">
    <img id="cover" class="cover" src="cover.jpg">
    <h2 id="title">No song selected</h2>
    <input type="range" id="progress" value="0">
    <div class="controls">
      <button onclick="toggleShuffle()"><i class="fa-solid fa-shuffle"></i></button>
      <button onclick="prevSong()"><i class="fa-solid fa-backward"></i></button>
      <button onclick="playPause()"><i class="fa-solid fa-play"></i></button>
      <button onclick="nextSong()"><i class="fa-solid fa-forward"></i></button>
      <button onclick="toggleRepeat()"><i class="fa-solid fa-repeat"></i></button>
    </div>
    <input type="range" id="volume" min="0" max="1" step="0.01">
    <ul id="playlist"></ul>

    <!-- Lyrics -->
    <div class="lyrics" id="lyrics">Lyrics will appear here...</div>

    <!-- Equalizer -->
    <div class="equalizer">
      <input type="range" id="bass" min="-10" max="10" value="0">
      <input type="range" id="mid" min="-10" max="10" value="0">
      <input type="range" id="treble" min="-10" max="10" value="0">
    </div>

    <audio id="audio"></audio>
  </div>
</div>

<!-- Mini Player -->
<div class="mini" id="miniPlayer">
  <img id="miniCover" src="cover.jpg">
  <div class="info">
    <div id="miniTitle">No song</div>
    <input type="range" id="miniProgress" value="0">
  </div>
  <button onclick="playPause()"><i class="fa-solid fa-play"></i></button>
  <button onclick="nextSong()"><i class="fa-solid fa-forward"></i></button>
</div>

<!-- Install Toast -->
<div id="installToast">
  Install WaveBox to your device!
  <button id="toastInstallBtn" style="
    margin-left: 12px; padding: 6px 12px; border: none; border-radius: 6px;
    background: white; color: #38bdf8; cursor: pointer;
  ">Install</button>
</div>

<script>
// Sidebar toggle
const sidebar = document.getElementById('sidebar');
const menuToggle = document.getElementById('menuToggle');
menuToggle.addEventListener('click', () => {
  sidebar.classList.toggle('active');
});

// Core
let songs=[], index=0, shuffle=false, repeat=false;
const audio=document.getElementById("audio");
const title=document.getElementById("title");
const cover=document.getElementById("cover");
const miniCover=document.getElementById("miniCover");
const miniTitle=document.getElementById("miniTitle");
const progress=document.getElementById("progress");
const miniProgress=document.getElementById("miniProgress");
const volume=document.getElementById("volume");
const playlist=document.getElementById("playlist");
const fileInput=document.getElementById("fileInput");
const lyricsEl=document.getElementById("lyrics");

// Add multiple songs repeatedly
fileInput.addEventListener("change", () => { 
  [...fileInput.files].forEach(file=>{
    songs.push({
      title: file.name.replace(/\.[^/.]+$/, ""),
      src: URL.createObjectURL(file),
      cover: "cover.jpg",
      lyrics: "Lyrics not available"
    });
  });

  if (!audio.src && songs.length > 0) loadSong(0);
  updatePlaylist();
  fileInput.value = ""; // allow re-selecting same files
});

// Load song
function loadSong(i){
  if(!songs.length) return;
  index=i;
  audio.src=songs[i].src;
  title.textContent=songs[i].title;
  miniTitle.textContent=songs[i].title;
  cover.src=miniCover.src=songs[i].cover;
  lyricsEl.textContent = songs[i].lyrics;
  updatePlaylist();
}

// Controls
async function playPause(){try{audio.paused?await audio.play():audio.pause();}catch(e){console.log("Play interrupted")}}
function nextSong(){if(!songs.length) return; index = shuffle?Math.floor(Math.random()*songs.length):(index+1)%songs.length; loadSong(index); audio.play();}
function prevSong(){if(!songs.length) return; index = (index-1+songs.length)%songs.length; loadSong(index); audio.play();}
function toggleShuffle(){shuffle=!shuffle;}
function toggleRepeat(){repeat=!repeat; audio.loop=repeat;}
function toggleTheme(){document.body.classList.toggle("light");}

// Sliders
audio.addEventListener("timeupdate",()=>{const p=(audio.currentTime/audio.duration)*100||0; progress.value=miniProgress.value=p;});
progress.oninput=()=>audio.currentTime=(progress.value/100)*audio.duration;
miniProgress.oninput=progress.oninput;
volume.oninput=()=>audio.volume=volume.value;

// Playlist
function updatePlaylist(){
  playlist.innerHTML="";
  songs.forEach((s,i)=>{
    const li=document.createElement("li");
    li.textContent=s.title;
    if(i===index) li.classList.add("active");
    li.onclick=()=>{loadSong(i); audio.play();}
    playlist.appendChild(li);
  });
}

// Mini player drag
const mini=document.getElementById("miniPlayer");
let isDragging=false, offsetX=0, offsetY=0;
mini.addEventListener("mousedown", e=>{isDragging=true; offsetX=e.offsetX; offsetY=e.offsetY;});
document.addEventListener("mouseup", ()=>isDragging=false);
document.addEventListener("mousemove", e=>{if(!isDragging) return; mini.style.right="auto"; mini.style.bottom="auto"; mini.style.left=e.pageX-offsetX+"px"; mini.style.top=e.pageY-offsetY+"px";});

// PWA install toast
let deferredPrompt;
const installToast = document.getElementById('installToast');
const toastBtn = document.getElementById('toastInstallBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installToast.classList.add('show');
});

toastBtn.addEventListener('click', async () => {
  installToast.classList.remove('show');
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    console.log('User response to install:', outcome);
    deferredPrompt = null;
  }
});

document.getElementById('installBtn').addEventListener('click', () => {
  installToast.classList.add('show');
  setTimeout(()=>installToast.classList.remove('show'), 5000);
});
</script>

</body>
</html>
